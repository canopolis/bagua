<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lo Pan Bagua Feng Shui Map</title>

    <!-- iOS Homescreen Icons - Todos con la nueva imagen -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://i.postimg.cc/RVzPvw7p/map.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://i.postimg.cc/RVzPvw7p/map.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://i.postimg.cc/RVzPvw7p/map.png">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/RVzPvw7p/map.png">

    <!-- Web App Manifest -->
    <link rel="manifest" href="application/manifest+json,{%22name%22:%22Bagua%20Feng%20Shui%22,%22short_name%22:%22Bagua%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22%23f5f5f5%22,%22description%22:%22Lo%20Pan%20Bagua%20Feng%20Shui%20Map%22}">

    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Bagua Feng Shui">

    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #8B4513;
            margin-bottom: 20px;
        }

        .compass-container {
            position: relative;
            width: 500px;
            height: 500px;
            margin: 0 auto 30px;
        }

        #bagua {
            width: 100%;
            height: 100%;
            transition: transform 0.2s ease;
        }

        .direction-marker {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 25px solid #FFD700; /* Triángulo dorado */
            z-index: 11;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
            display: none;
        }

        .compass-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            position: relative;
        }

        .sector-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: left;
            margin-top: 20px;
        }

        .sector-info h2 {
            color: #8B4513;
            margin-top: 0;
        }

        .cure-list {
            list-style-type: disc;
            padding-left: 20px;
        }

        .error {
            color: #d32f2f;
            padding: 10px;
            background: #ffebee;
            border-radius: 4px;
            margin: 10px 0;
        }

        .loading {
            color: #666;
        }

        #lockButton {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        #lockButton.locked {
            background-color: #f44336;
        }

        #lockButton:hover {
            opacity: 0.9;
        }

        .lock-reminder {
            display: none;
            color: #ff9800;
            font-size: 14px;
            margin-top: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        @media (max-width: 600px) {
            .compass-container {
                width: 350px;
                height: 350px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Lo Pan Bagua Feng Shui Map</h1>

        <div class="compass-info">
            <p class="loading" id="status">Initializing compass...</p>
            <p><strong>Compass Direction:</strong> <span id="compass-reading">--</span>°</p>
            <p><strong>Facing Direction:</strong> <span id="facing-direction">--</span></p>
            <button id="lockButton" onclick="toggleLock()">Lock Zone</button>
            <p class="lock-reminder" id="lockReminder">⚠️ Remember to unlock the compass to continue exploring other directions</p>
        </div>

        <div class="compass-container">
            <!-- Bagua 3 Image -->
            <img id="bagua" src="https://i.postimg.cc/RVzPvw7p/map.png" alt="Bagua Map">
            <!-- Marcadores de dirección (inversos: el triángulo apunta al sur del dispositivo) -->
            <div class="direction-marker" id="northMarker" style="bottom: -10px; left: 50%; transform: translateX(-50%) rotate(180deg);"></div>
            <div class="direction-marker" id="northeastMarker" style="bottom: 15px; right: 15px; transform: rotate(225deg);"></div>
            <div class="direction-marker" id="eastMarker" style="top: 50%; right: -10px; transform: translateY(-50%) rotate(0deg);"></div>
            <div class="direction-marker" id="southeastMarker" style="top: 15px; right: 15px; transform: rotate(45deg);"></div>
            <div class="direction-marker" id="southMarker" style="top: -10px; left: 50%; transform: translateX(-50%) rotate(0deg);"></div>
            <div class="direction-marker" id="southwestMarker" style="top: 15px; left: 15px; transform: rotate(135deg);"></div>
            <div class="direction-marker" id="westMarker" style="top: 50%; left: -10px; transform: translateY(-50%) rotate(180deg);"></div>
            <div class="direction-marker" id="northwestMarker" style="bottom: 15px; left: 15px; transform: rotate(315deg);"></div>
        </div>

        <div class="sector-info" id="sector-info">
            <h2>Point your device to a direction to see specific feng shui recommendations</h2>
        </div>
    </div>

    <script>
        let isLocked = false;
        let reminderTimeout = null;
        let useWebKitCompass = false;
        let currentDirection = '';

        const sectorData = {
            'North': {
                element: 'Water',
                area: 'Career & Life Path',
                cures: [
                    'Add water features like fountains or aquariums',
                    'Use black or dark blue decor',
                    'Display images of water scenes',
                    'Add wavy or curved shapes',
                    'Use mirrors to represent water',
                    'Keep this area clean and clutter-free',
                    'Add career-related symbols or awards',
                    'Include metal elements (white, gray, metallic colors) as Metal nourishes Water in the productive cycle',
                    'Use Black Tourmaline or Obsidian in pyramid shape for protection and grounding',
                    'Place Clear Quartz points facing inward to amplify career energy',
                    'Use Amethyst clusters for wisdom and clarity in career decisions'
                ]
            },
            'Northeast': {
                element: 'Earth',
                area: 'Knowledge & Education',
                cures: [
                    'Place crystals or stones',
                    'Add ceramic or pottery items',
                    'Use earth tone colors (beige, yellow, brown)',
                    'Create a study or meditation area',
                    'Display books and educational materials',
                    'Add mountain imagery',
                    'Use square shapes and patterns',
                    'Include fire elements (candles, red accents) as Fire nourishes Earth in the productive cycle',
                    'Use Citrine or Yellow Jasper in cube shape to enhance learning and memory',
                    'Place Tiger Eye stones for focus and mental clarity',
                    'Use Carnelian in pyramid shape to stimulate creativity and knowledge'
                ]
            },
            'East': {
                element: 'Wood',
                area: 'Family & Health',
                cures: [
                    'Add healthy plants or flowers',
                    'Use wooden furniture or decor',
                    'Display family photos in wooden frames',
                    'Use green and brown colors',
                    'Place bamboo or lucky bamboo',
                    'Use rectangular shapes',
                    'Keep this area vibrant and alive',
                    'Include water elements (fountains, blue colors) as Water nourishes Wood in the productive cycle',
                    'Use Green Aventurine in wand or palm stone form for family harmony',
                    'Place Jade stones for health and longevity',
                    'Use Emerald chips in bowl for family unity and growth'
                ]
            },
            'Southeast': {
                element: 'Wood',
                area: 'Wealth & Prosperity',
                cures: [
                    'Place a money tree or jade plant',
                    'Add a small fountain (flowing inward)',
                    'Use purple, gold, or green accents',
                    'Display symbols of abundance',
                    'Keep a bowl of coins or crystals',
                    'Add wind chimes for energy flow',
                    'Ensure good lighting in this area',
                    'Include water elements (aquarium, water imagery) as Water nourishes Wood in the productive cycle',
                    'Use Citrine points or clusters for wealth attraction',
                    'Place Pyrite cubes for financial stability and abundance',
                    'Use Peridot in heart shape for prosperity and growth'
                ]
            },
            'South': {
                element: 'Fire',
                area: 'Fame & Recognition',
                cures: [
                    'Add candles or bright lighting',
                    'Use red or orange decor',
                    'Display awards and certificates',
                    'Add triangular or pointed shapes',
                    'Place red flowers or artwork',
                    'Display your achievements',
                    'Add a fireplace or red lamp',
                    'Include wood elements (plants, green colors) as Wood nourishes Fire in the productive cycle',
                    'Use Red Jasper or Carnelian in pointed shapes for recognition',
                    'Place Sunstone for leadership and personal power',
                    'Use Ruby chips in bowl for fame and success'
                ]
            },
            'Southwest': {
                element: 'Earth',
                area: 'Love & Relationships',
                cures: [
                    'Use pairs of objects (2 candles, 2 pillows)',
                    'Add rose quartz or pink crystals',
                    'Display romantic artwork or photos',
                    'Use pink, red, or earth tones',
                    'Place fresh flowers (especially peonies)',
                    'Add ceramic or pottery pairs',
                    'Create a cozy seating area for two',
                    'Include fire elements (candles, pink/red colors) as Fire nourishes Earth in the productive cycle',
                    'Use Rose Quartz spheres for love and relationships',
                    'Place Pink Tourmaline hearts for emotional healing',
                    'Use Rhodochrosite in heart shape for deep connections'
                ]
            },
            'West': {
                element: 'Metal',
                area: 'Children & Creativity',
                cures: [
                    'Add metal decor or sculptures',
                    'Use white or metallic colors',
                    'Display children\'s artwork or photos',
                    'Create a creative workspace',
                    'Add round or circular shapes',
                    'Place bells or chimes',
                    'Keep playful or whimsical items',
                    'Include earth elements (crystals, yellow colors) as Earth nourishes Metal in the productive cycle',
                    'Use White Howlite or Selenite in circular shapes for creativity',
                    'Place Hematite spheres for focus and concentration',
                    'Use Moonstone in crescent shape for intuition and inspiration'
                ]
            },
            'Northwest': {
                element: 'Metal',
                area: 'Helpful People & Travel',
                cures: [
                    'Add metal objects or decor',
                    'Display travel photos or maps',
                    'Use white, gray, or metallic colors',
                    'Place religious or spiritual items',
                    'Add images of mentors or guides',
                    'Use circular or dome shapes',
                    'Display globe or travel souvenirs',
                    'Include earth elements (stones, ceramic items) as Earth nourishes Metal in the productive cycle',
                    'Use Clear Quartz or Amethyst in sphere shape for spiritual guidance',
                    'Place Black Onyx for protection during travels',
                    'Use Smoky Quartz points for grounding and support from mentors'
                ]
            }
        };

        function toggleLock() {
            isLocked = !isLocked;
            const lockButton = document.getElementById('lockButton');
            const lockReminder = document.getElementById('lockReminder');
            
            if (isLocked) {
                lockButton.textContent = 'Locked Zone';
                lockButton.classList.add('locked');
                reminderTimeout = setTimeout(() => {
                    lockReminder.style.display = 'block';
                }, 30000);
            } else {
                lockButton.textContent = 'Lock Zone';
                lockButton.classList.remove('locked');
                lockReminder.style.display = 'none';
                if (reminderTimeout) clearTimeout(reminderTimeout);
            }
        }

        function updateSectorInfo(direction) {
            if (isLocked) return;
            currentDirection = direction;
            const data = sectorData[direction];
            if (!data) return;
            
            const infoDiv = document.getElementById('sector-info');
            infoDiv.innerHTML = `
                <h2>${direction} - ${data.element} Element</h2>
                <h3>${data.area}</h3>
                <ul class="cure-list">
                    ${data.cures.map(cure => `<li>${cure}</li>`).join('')}
                </ul>
            `;
        }

        function updateCompass(heading) {
            document.getElementById('compass-reading').textContent = Math.round(heading);

            // Invertimos el heading: el dispositivo apunta al norte → el mapa muestra sur
            let invertedHeading = (heading + 180) % 360;
            let facingDirection = '';
            if (invertedHeading >= 337.5 || invertedHeading < 22.5) facingDirection = 'North';
            else if (invertedHeading >= 22.5 && invertedHeading < 67.5) facingDirection = 'Northeast';
            else if (invertedHeading >= 67.5 && invertedHeading < 112.5) facingDirection = 'East';
            else if (invertedHeading >= 112.5 && invertedHeading < 157.5) facingDirection = 'Southeast';
            else if (invertedHeading >= 157.5 && invertedHeading < 202.5) facingDirection = 'South';
            else if (invertedHeading >= 202.5 && invertedHeading < 247.5) facingDirection = 'Southwest';
            else if (invertedHeading >= 247.5 && invertedHeading < 292.5) facingDirection = 'West';
            else if (invertedHeading >= 292.5 && invertedHeading < 337.5) facingDirection = 'Northwest';

            if (!isLocked) {
                document.getElementById('facing-direction').textContent = facingDirection;
                
                // No rotamos el Bagua
                document.getElementById('bagua').style.transform = 'none';
                
                // Mostramos el marcador correcto
                hideAllMarkers();
                showDirectionMarker(facingDirection);
                
                // Actualizamos la información
                updateSectorInfo(facingDirection);
            }
        }

        function hideAllMarkers() {
            const markers = document.querySelectorAll('.direction-marker');
            markers.forEach(marker => marker.style.display = 'none');
        }

        function showDirectionMarker(direction) {
            const markerId = direction.toLowerCase() + 'Marker';
            const marker = document.getElementById(markerId);
            if (marker) marker.style.display = 'block';
        }

        function handleOrientation(event) {
            let heading = null;
            if (event.webkitCompassHeading !== undefined && event.webkitCompassHeading !== null) {
                heading = event.webkitCompassHeading;
                useWebKitCompass = true;
            } else if (event.alpha !== null) {
                heading = 360 - event.alpha;
                if (heading >= 360) heading -= 360;
                useWebKitCompass = false;
            }
            
            if (heading !== null) {
                updateCompass(heading);
                document.getElementById('status').textContent = useWebKitCompass ? 
                    'Compass active (WebKit)' : 'Compass active (Alpha)';
                document.getElementById('status').className = '';
            }
        }

        if ('DeviceOrientationEvent' in window) {
            if ('ondeviceorientationabsolute' in window) {
                window.addEventListener('deviceorientationabsolute', (event) => {
                    if (event.absolute === true) handleOrientation(event);
                });
            }
            window.addEventListener('deviceorientation', handleOrientation);

            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                document.getElementById('status').innerHTML = '<button onclick="requestCompassPermission()">Enable Compass</button>';
            }
        } else {
            document.getElementById('status').textContent = 'Compass not supported';
            document.getElementById('status').className = 'error';
        }

        function requestCompassPermission() {
            DeviceOrientationEvent.requestPermission()
                .then(response => {
                    if (response === 'granted') {
                        document.getElementById('status').textContent = 'Compass permission granted. Move device to calibrate.';
                        document.getElementById('status').className = 'loading';
                    } else {
                        document.getElementById('status').textContent = 'Compass permission denied';
                        document.getElementById('status').className = 'error';
                    }
                })
                .catch(error => {
                    console.error('Error requesting compass permission:', error);
                    document.getElementById('status').textContent = 'Error requesting compass permission';
                    document.getElementById('status').className = 'error';
                });
        }

        // Soporte para escritorio
        if (!('ontouchstart' in window)) {
            const slider = document.createElement('input');
            slider.type = 'range';
            slider.min = '0';
            slider.max = '360';
            slider.value = '0';
            slider.oninput = () => updateCompass(parseInt(this.value));
            document.getElementById('status').appendChild(document.createElement('br'));
            document.getElementById('status').appendChild(document.createElement('br'));
            document.getElementById('status').appendChild(slider);
        }
    </script>
</body>
</html>