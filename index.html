<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Lo Pan Bagua Feng Shui Map</title>

    <!-- Favicon base -->
    <link rel="icon" href="https://i.postimg.cc/d3ZvKpyf/pakua.png" type="image/png">

    <!-- iOS Homescreen Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://i.postimg.cc/d3ZvKpyf/pakua.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://i.postimg.cc/d3ZvKpyf/pakua.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://i.postimg.cc/d3ZvKpyf/pakua.png">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/d3ZvKpyf/pakua.png">

    <!-- Android Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="https://i.postimg.cc/d3ZvKpyf/pakua.png">
    <link rel="icon" type="image/png" sizes="512x512" href="https://i.postimg.cc/d3ZvKpyf/pakua.png">

    <!-- Web App Manifest -->
    <link rel="manifest" href="application/manifest+json,{
        %22name%22:%22Lo%20Pan%20Bagua%20Feng%20Shui%22,
        %22short_name%22:%22Bagua%22,
        %22start_url%22:%22.%22,
        %22display%22:%22standalone%22,
        %22background_color%22:%22%23f5f5f5%22,
        %22theme_color%22:%22%238B4513%22,
        %22icons%22:[{
            %22src%22:%22https://i.postimg.cc/d3ZvKpyf/pakua.png%22,
            %22sizes%22:%22192x192%22,
            %22type%22:%22image/png%22
        },{
            %22src%22:%22https://i.postimg.cc/d3ZvKpyf/pakua.png%22,
            %22sizes%22:%22512x512%22,
            %22type%22:%22image/png%22
        }]
    }">

    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Bagua Feng Shui">
    <meta name="theme-color" content="#8B4513">
    <meta name="description" content="Lo Pan Bagua Feng Shui Compass for energy alignment and cures.">

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 20px 0;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 820px;
            width: 100%;
            margin: 0 auto;
            padding: 0 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #8B4513;
            margin-bottom: 20px;
            font-size: 1.8rem;
            text-align: center;
        }

        .compass-container {
            position: relative;
            width: 500px;
            height: 500px;
            margin: 20px auto;
        }

        #bagua {
            width: 100%;
            height: 100%;
            transition: transform 0.2s ease;
        }

        .direction-marker {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 25px solid #FFD700;
            z-index: 11;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
            display: none;
        }

        .compass-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            position: relative;
            width: 90%;
            max-width: 500px;
            text-align: left;
        }

        .switch-container {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #555;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 8px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4CAF50; /* Verde para ENG */
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3; /* Azul para ES */
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .sector-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: left;
            margin-top: 20px;
            width: 90%;
            max-width: 500px;
        }

        .sector-info h2 {
            color: #8B4513;
            margin-top: 0;
        }

        .cure-list {
            list-style-type: disc;
            padding-left: 20px;
        }

        .error {
            color: #d32f22;
            padding: 10px;
            background: #ffebee;
            border-radius: 4px;
            margin: 10px 0;
        }

        .loading {
            color: #666;
        }

        #lockButton {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        #lockButton.locked {
            background-color: #f44336;
        }

        #lockButton:hover {
            opacity: 0.9;
        }

        .lock-reminder {
            display: none;
            color: #ff9800;
            font-size: 14px;
            margin-top: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        @media (max-width: 600px) {
            .compass-container {
                width: 350px;
                height: 350px;
            }
            h1 {
                font-size: 1.5rem;
            }
            .compass-info, .sector-info {
                width: 100%;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="title">Lo Pan Bagua Feng Shui Map</h1>

        <div class="compass-info">
            <p class="loading" id="status">Initializing compass...</p>
            <p><strong>Compass Direction:</strong> <span id="compass-reading">--</span>°</p>
            <p><strong>Facing Direction:</strong> <span id="facing-direction">--</span></p>
            <button id="lockButton">Lock Zone</button>
            <p class="lock-reminder" id="lockReminder">⚠️ Remember to unlock the compass to continue exploring other directions</p>
            
            <!-- Switch ENG/ES -->
            <div class="switch-container">
                <span id="langLabel">ENG-ES</span>
                <label class="switch">
                    <input type="checkbox" id="langToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="compass-container">
            <!-- Bagua Image -->
            <img id="bagua" src="https://i.postimg.cc/VLdNJxBd/pakua.png" alt="Bagua Map">

            <!-- Marcadores direccionales -->
            <div class="direction-marker" id="northMarker" style="top: -10px; left: 50%; transform: translateX(-50%) rotate(180deg);"></div>
            <div class="direction-marker" id="northeastMarker" style="top: 15px; right: 15px; transform: rotate(225deg);"></div>
            <div class="direction-marker" id="eastMarker" style="top: 50%; right: -10px; transform: translateY(-50%) rotate(270deg);"></div>
            <div class="direction-marker" id="southeastMarker" style="bottom: 15px; right: 15px; transform: rotate(135deg);"></div>
            <div class="direction-marker" id="southMarker" style="bottom: -10px; left: 50%; transform: translateX(-50%) rotate(0deg);"></div>
            <div class="direction-marker" id="southwestMarker" style="bottom: 15px; left: 15px; transform: rotate(45deg);"></div>
            <div class="direction-marker" id="westMarker" style="top: 50%; left: -10px; transform: translateY(-50%) rotate(90deg);"></div>
            <div class="direction-marker" id="northwestMarker" style="top: 15px; left: 15px; transform: rotate(315deg);"></div>
        </div>

        <div class="sector-info" id="sector-info">
            <h2>Point your device to a direction to see specific feng shui recommendations</h2>
        </div>
    </div>

    <script>
        let isLocked = false;
        let reminderTimeout = null;
        let isSpanish = false; // false = ENG, true = ES

        // Textos en ambos idiomas
        const texts = {
            en: {
                title: 'Lo Pan Bagua Feng Shui Map',
                statusInit: 'Initializing compass...',
                statusGranted: 'Compass permission granted. Move device to calibrate.',
                statusDenied: 'Compass permission denied',
                statusError: 'Error requesting compass permission',
                statusNoSupport: 'Compass not supported',
                compassDir: 'Compass Direction',
                facingDir: 'Facing Direction',
                lockButton: 'Lock Zone',
                lockButtonLocked: 'Locked Zone',
                lockReminder: '⚠️ Remember to unlock the compass to continue exploring other directions',
                defaultText: 'Point your device to a direction to see specific feng shui recommendations'
            },
            es: {
                title: 'Mapa Lo Pan Bagua Feng Shui',
                statusInit: 'Inicializando brújula...',
                statusGranted: 'Permiso de brújula concedido. Mueva el dispositivo para calibrar.',
                statusDenied: 'Permiso de brújula denegado',
                statusError: 'Error al solicitar permiso de brújula',
                statusNoSupport: 'Brújula no soportada',
                compassDir: 'Dirección de la Brújula',
                facingDir: 'Dirección que enfrenta',
                lockButton: 'Bloquear Zona',
                lockButtonLocked: 'Zona Bloqueada',
                lockReminder: '⚠️ Recuerda desbloquear la brújula para explorar otras direcciones',
                defaultText: 'Apunta tu dispositivo a una dirección para ver recomendaciones específicas de feng shui'
            }
        };

        // Datos de sectores en ambos idiomas
        const sectorData = {
            en: {
                'North': {
                    element: 'Water',
                    area: 'Career & Life Path',
                    cures: [
                        'Add water features like fountains or aquariums',
                        'Use black or dark blue decor',
                        'Display images of water scenes',
                        'Add wavy or curved shapes',
                        'Use mirrors to represent water',
                        'Keep this area clean and clutter-free',
                        'Add career-related symbols or awards',
                        'Include metal elements (white, gray, metallic colors) as Metal nourishes Water in the productive cycle',
                        'Use Black Tourmaline or Obsidian in pyramid shape for protection and grounding',
                        'Place Clear Quartz points facing inward to amplify career energy',
                        'Use Amethyst clusters for wisdom and clarity in career decisions'
                    ]
                },
                'Northeast': {
                    element: 'Earth',
                    area: 'Knowledge & Education',
                    cures: [
                        'Place crystals or stones',
                        'Add ceramic or pottery items',
                        'Use earth tone colors (beige, yellow, brown)',
                        'Create a study or meditation area',
                        'Display books and educational materials',
                        'Add mountain imagery',
                        'Use square shapes and patterns',
                        'Include fire elements (candles, red accents) as Fire nourishes Earth in the productive cycle',
                        'Use Citrine or Yellow Jasper in cube shape to enhance learning and memory',
                        'Place Tiger Eye stones for focus and mental clarity',
                        'Use Carnelian in pyramid shape to stimulate creativity and knowledge'
                    ]
                },
                'East': {
                    element: 'Wood',
                    area: 'Family & Health',
                    cures: [
                        'Add healthy plants or flowers',
                        'Use wooden furniture or decor',
                        'Display family photos in wooden frames',
                        'Use green and brown colors',
                        'Place bamboo or lucky bamboo',
                        'Use rectangular shapes',
                        'Keep this area vibrant and alive',
                        'Include water elements (fountains, blue colors) as Water nourishes Wood in the productive cycle',
                        'Use Green Aventurine in wand or palm stone form for family harmony',
                        'Place Jade stones for health and longevity',
                        'Use Emerald chips in bowl for family unity and growth'
                    ]
                },
                'Southeast': {
                    element: 'Wood',
                    area: 'Wealth & Prosperity',
                    cures: [
                        'Place a money tree or jade plant',
                        'Add a small fountain (flowing inward)',
                        'Use purple, gold, or green accents',
                        'Display symbols of abundance',
                        'Keep a bowl of coins or crystals',
                        'Add wind chimes for energy flow',
                        'Ensure good lighting in this area',
                        'Include water elements (aquarium, water imagery) as Water nourishes Wood in the productive cycle',
                        'Use Citrine points or clusters for wealth attraction',
                        'Place Pyrite cubes for financial stability and abundance',
                        'Use Peridot in heart shape for prosperity and growth'
                    ]
                },
                'South': {
                    element: 'Fire',
                    area: 'Fame & Recognition',
                    cures: [
                        'Add candles or bright lighting',
                        'Use red or orange decor',
                        'Display awards and certificates',
                        'Add triangular or pointed shapes',
                        'Place red flowers or artwork',
                        'Display your achievements',
                        'Add a fireplace or red lamp',
                        'Include wood elements (plants, green colors) as Wood nourishes Fire in the productive cycle',
                        'Use Red Jasper or Carnelian in pointed shapes for recognition',
                        'Place Sunstone for leadership and personal power',
                        'Use Ruby chips in bowl for fame and success'
                    ]
                },
                'Southwest': {
                    element: 'Earth',
                    area: 'Love & Relationships',
                    cures: [
                        'Use pairs of objects (2 candles, 2 pillows)',
                        'Add rose quartz or pink crystals',
                        'Display romantic artwork or photos',
                        'Use pink, red, or earth tones',
                        'Place fresh flowers (especially peonies)',
                        'Add ceramic or pottery pairs',
                        'Create a cozy seating area for two',
                        'Include fire elements (candles, pink/red colors) as Fire nourishes Earth in the productive cycle',
                        'Use Rose Quartz spheres for love and relationships',
                        'Place Pink Tourmaline hearts for emotional healing',
                        'Use Rhodochrosite in heart shape for deep connections'
                    ]
                },
                'West': {
                    element: 'Metal',
                    area: 'Children & Creativity',
                    cures: [
                        'Add metal decor or sculptures',
                        'Use white or metallic colors',
                        'Display children\'s artwork or photos',
                        'Create a creative workspace',
                        'Add round or circular shapes',
                        'Place bells or chimes',
                        'Keep playful or whimsical items',
                        'Include earth elements (crystals, yellow colors) as Earth nourishes Metal in the productive cycle',
                        'Use White Howlite or Selenite in circular shapes for creativity',
                        'Place Hematite spheres for focus and concentration',
                        'Use Moonstone in crescent shape for intuition and inspiration'
                    ]
                },
                'Northwest': {
                    element: 'Metal',
                    area: 'Helpful People & Travel',
                    cures: [
                        'Add metal objects or decor',
                        'Display travel photos or maps',
                        'Use white, gray, or metallic colors',
                        'Place religious or spiritual items',
                        'Add images of mentors or guides',
                        'Use circular or dome shapes',
                        'Display globe or travel souvenirs',
                        'Include earth elements (stones, ceramic items) as Earth nourishes Metal in the productive cycle',
                        'Use Clear Quartz or Amethyst in sphere shape for spiritual guidance',
                        'Place Black Onyx for protection during travels',
                        'Use Smoky Quartz points for grounding and support from mentors'
                    ]
                }
            },
            es: {
                'North': {
                    element: 'Agua',
                    area: 'Carrera y Camino de Vida',
                    cures: [
                        'Agrega elementos de agua como fuentes o acuarios',
                        'Usa decoración negra o azul oscuro',
                        'Muestra imágenes de escenas acuáticas',
                        'Agrega formas onduladas o curvas',
                        'Usa espejos para representar el agua',
                        'Mantén esta zona limpia y libre de desorden',
                        'Agrega símbolos o premios relacionados con tu carrera',
                        'Incluye elementos de metal (blanco, gris, colores metálicos) ya que el Metal nutre al Agua en el ciclo productivo',
                        'Usa Turmalina Negra u Obsidiana en forma de pirámide para protección y arraigo',
                        'Coloca puntos de Cuarzo Transparente mirando hacia adentro para amplificar la energía de la carrera',
                        'Usa racimos de Amatista para sabiduría y claridad en decisiones laborales'
                    ]
                },
                'Northeast': {
                    element: 'Tierra',
                    area: 'Conocimiento y Educación',
                    cures: [
                        'Coloca cristales o piedras',
                        'Agrega objetos de cerámica o alfarería',
                        'Usa colores tierra (beige, amarillo, marrón)',
                        'Crea un área de estudio o meditación',
                        'Muestra libros y material educativo',
                        'Agrega imágenes de montañas',
                        'Usa formas y patrones cuadrados',
                        'Incluye elementos de fuego (velas, acentos rojos) ya que el Fuego nutre a la Tierra en el ciclo productivo',
                        'Usa Cuarzo Citrino o Jaspe Amarillo en forma de cubo para mejorar el aprendizaje y la memoria',
                        'Coloca piedras de Ojo de Tigre para enfoque y claridad mental',
                        'Usa Cornalina en forma de pirámide para estimular la creatividad y el conocimiento'
                    ]
                },
                'East': {
                    element: 'Madera',
                    area: 'Familia y Salud',
                    cures: [
                        'Agrega plantas sanas o flores',
                        'Usa muebles o decoración de madera',
                        'Muestra fotos familiares en marcos de madera',
                        'Usa colores verdes y marrones',
                        'Coloca bambú o bambú de la suerte',
                        'Usa formas rectangulares',
                        'Mantén esta zona vibrante y viva',
                        'Incluye elementos de agua (fuentes, colores azules) ya que el Agua nutre a la Madera en el ciclo productivo',
                        'Usa Aventurina Verde en forma de varita o piedra de bolsillo para armonía familiar',
                        'Coloca piedras de Jade para salud y longevidad',
                        'Usa trozos de Esmeralda en un bol para unidad y crecimiento familiar'
                    ]
                },
                'Southeast': {
                    element: 'Madera',
                    area: 'Riqueza y Prosperidad',
                    cures: [
                        'Coloca un árbol de la fortuna o planta de jade',
                        'Agrega una pequeña fuente (con flujo hacia adentro)',
                        'Usa acentos morados, dorados o verdes',
                        'Muestra símbolos de abundancia',
                        'Mantén un bol de monedas o cristales',
                        'Agrega carillones para flujo de energía',
                        'Asegúrate de tener buena iluminación en esta zona',
                        'Incluye elementos de agua (acuarios, imágenes de agua) ya que el Agua nutre a la Madera en el ciclo productivo',
                        'Usa puntos o racimos de Citrino para atraer riqueza',
                        'Coloca cubos de Piritas para estabilidad financiera y abundancia',
                        'Usa Peridoto en forma de corazón para prosperidad y crecimiento'
                    ]
                },
                'South': {
                    element: 'Fuego',
                    area: 'Fama y Reconocimiento',
                    cures: [
                        'Agrega velas o iluminación brillante',
                        'Usa decoración roja u naranja',
                        'Muestra premios y certificados',
                        'Agrega formas triangulares o puntiagudas',
                        'Coloca flores rojas u obras de arte',
                        'Muestra tus logros',
                        'Agrega una chimenea o lámpara roja',
                        'Incluye elementos de madera (plantas, colores verdes) ya que la Madera nutre al Fuego en el ciclo productivo',
                        'Usa Jaspe Rojo o Cornalina en formas puntiagudas para reconocimiento',
                        'Coloca Piedra de Sol para liderazgo y poder personal',
                        'Usa trozos de Rubí en un bol para fama y éxito'
                    ]
                },
                'Southwest': {
                    element: 'Tierra',
                    area: 'Amor y Relaciones',
                    cures: [
                        'Usa objetos en pareja (2 velas, 2 almohadas)',
                        'Agrega cuarzo rosa o cristales rosados',
                        'Muestra arte romántico o fotos',
                        'Usa tonos rosados, rojos o tierra',
                        'Coloca flores frescas (especialmente peonías)',
                        'Agrega pares de cerámica o alfarería',
                        'Crea un área acogedora para dos personas',
                        'Incluye elementos de fuego (velas, colores rosados/rojos) ya que el Fuego nutre a la Tierra en el ciclo productivo',
                        'Usa esferas de Cuarzo Rosa para amor y relaciones',
                        'Coloca corazones de Turmalina Rosa para sanación emocional',
                        'Usa Rodocrosita en forma de corazón para conexiones profundas'
                    ]
                },
                'West': {
                    element: 'Metal',
                    area: 'Niños y Creatividad',
                    cures: [
                        'Agrega decoración o esculturas de metal',
                        'Usa colores blancos o metálicos',
                        'Muestra arte o fotos de tus hijos',
                        'Crea un espacio creativo',
                        'Agrega formas redondas o circulares',
                        'Coloca campanas o carillones',
                        'Mantén objetos lúdicos o divertidos',
                        'Incluye elementos de tierra (cristales, colores amarillos) ya que la Tierra nutre al Metal en el ciclo productivo',
                        'Usa Howlita Blanca o Selenita en formas circulares para creatividad',
                        'Coloca esferas de Hematita para enfoque y concentración',
                        'Usa Piedra de Luna en forma de media luna para intuición e inspiración'
                    ]
                },
                'Northwest': {
                    element: 'Metal',
                    area: 'Personas de Ayuda y Viajes',
                    cures: [
                        'Agrega objetos o decoración de metal',
                        'Muestra fotos de viajes o mapas',
                        'Usa colores blancos, grises o metálicos',
                        'Coloca objetos religiosos o espirituales',
                        'Agrega imágenes de mentores o guías',
                        'Usa formas circulares o cúpulas',
                        'Muestra globo terráqueo o recuerdos de viaje',
                        'Incluye elementos de tierra (piedras, objetos cerámicos) ya que la Tierra nutre al Metal en el ciclo productivo',
                        'Usa Cuarzo Transparente o Amatista en forma de esfera para guía espiritual',
                        'Coloca Onyx Negro para protección durante los viajes',
                        'Usa puntos de Cuarzo Ahumado para arraigo y apoyo de mentores'
                    ]
                }
            }
        };

        // Función para actualizar textos según idioma
        function updateLanguage() {
            const lang = isSpanish ? 'es' : 'en';
            const t = texts[lang];

            document.getElementById('title').textContent = t.title;
            document.getElementById('status').textContent = document.getElementById('status').classList.contains('error') ? 
                t.statusDenied : (document.getElementById('status').textContent.includes('active') ? 
                document.getElementById('status').textContent : t.statusInit);
            document.querySelector('#compass-info strong:nth-of-type(1)').textContent = t.compassDir + ':';
            document.querySelector('#compass-info strong:nth-of-type(2)').textContent = t.facingDir + ':';

            const lockButton = document.getElementById('lockButton');
            lockButton.textContent = isLocked ? t.lockButtonLocked : t.lockButton;

            document.getElementById('lockReminder').textContent = t.lockReminder;

            // Cambiar imagen del Bagua
            const baguaImg = document.getElementById('bagua');
            baguaImg.src = isSpanish ? 
                'https://i.postimg.cc/gjSfZwQj/1pakua-translated.png' : 
                'https://i.postimg.cc/VLdNJxBd/pakua.png'; // Nueva imagen en inglés

            // Actualizar sector-info si hay dirección activa
            if (currentDirection) {
                updateSectorInfo(currentDirection);
            }
        }

        // Toggle de idioma
        document.getElementById('langToggle').addEventListener('change', function () {
            isSpanish = this.checked;
            updateLanguage();
        });

        let currentDirection = '';

        function toggleLock() {
            isLocked = !isLocked;
            const t = texts[isSpanish ? 'es' : 'en'];
            const lockButton = document.getElementById('lockButton');
            lockButton.textContent = isLocked ? t.lockButtonLocked : t.lockButton;

            const lockReminder = document.getElementById('lockReminder');
            if (isLocked) {
                lockReminder.style.display = 'block';
                reminderTimeout = setTimeout(() => {
                    lockReminder.style.display = 'block';
                }, 30000);
            } else {
                lockReminder.style.display = 'none';
                if (reminderTimeout) clearTimeout(reminderTimeout);
            }
        }

        function updateSectorInfo(direction) {
            if (isLocked) return;
            currentDirection = direction;
            const lang = isSpanish ? 'es' : 'en';
            const data = sectorData[lang][direction];
            if (!data) return;

            const t = texts[lang];
            const infoDiv = document.getElementById('sector-info');
            infoDiv.innerHTML = `
                <h2>${direction} - ${data.element} ${lang === 'es' ? 'Elemento' : 'Element'}</h2>
                <h3>${data.area}</h3>
                <ul class="cure-list">
                    ${data.cures.map(cure => `<li>${cure}</li>`).join('')}
                </ul>
            `;
        }

        function updateCompass(heading) {
            document.getElementById('compass-reading').textContent = Math.round(heading);

            let facingDirection = '';
            if (heading >= 337.5 || heading < 22.5) facingDirection = 'North';
            else if (heading >= 22.5 && heading < 67.5) facingDirection = 'Northeast';
            else if (heading >= 67.5 && heading < 112.5) facingDirection = 'East';
            else if (heading >= 112.5 && heading < 157.5) facingDirection = 'Southeast';
            else if (heading >= 157.5 && heading < 202.5) facingDirection = 'South';
            else if (heading >= 202.5 && heading < 247.5) facingDirection = 'Southwest';
            else if (heading >= 247.5 && heading < 292.5) facingDirection = 'West';
            else if (heading >= 292.5 && heading < 337.5) facingDirection = 'Northwest';

            if (!isLocked) {
                document.getElementById('facing-direction').textContent = facingDirection;
                document.getElementById('bagua').style.transform = 'none';
                hideAllMarkers();
                showDirectionMarker(facingDirection);
                updateSectorInfo(facingDirection);
            }
        }

        function hideAllMarkers() {
            const markers = document.querySelectorAll('.direction-marker');
            markers.forEach(marker => marker.style.display = 'none');
        }

        function showDirectionMarker(direction) {
            const markerId = direction.toLowerCase() + 'Marker';
            const marker = document.getElementById(markerId);
            if (marker) marker.style.display = 'block';
        }

        function handleOrientation(event) {
            let heading = null;
            if (event.webkitCompassHeading !== undefined && event.webkitCompassHeading !== null) {
                heading = event.webkitCompassHeading;
            } else if (event.alpha !== null) {
                heading = 360 - event.alpha;
                if (heading >= 360) heading -= 360;
            }
            
            if (heading !== null) {
                updateCompass(heading);
                document.getElementById('status').textContent = 'Compass active (WebKit)';
                document.getElementById('status').className = '';
            }
        }

        if ('DeviceOrientationEvent' in window) {
            if ('ondeviceorientationabsolute' in window) {
                window.addEventListener('deviceorientationabsolute', (event) => {
                    if (event.absolute === true) handleOrientation(event);
                });
            }
            window.addEventListener('deviceorientation', handleOrientation);

            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                document.getElementById('status').innerHTML = `<button onclick="requestCompassPermission()">Enable Compass</button>`;
            }
        } else {
            const t = texts[isSpanish ? 'es' : 'en'];
            document.getElementById('status').textContent = t.statusNoSupport;
            document.getElementById('status').className = 'error';
        }

        function requestCompassPermission() {
            DeviceOrientationEvent.requestPermission()
                .then(response => {
                    if (response === 'granted') {
                        const t = texts[isSpanish ? 'es' : 'en'];
                        document.getElementById('status').textContent = t.statusGranted;
                        document.getElementById('status').className = 'loading';
                    } else {
                        const t = texts[isSpanish ? 'es' : 'en'];
                        document.getElementById('status').textContent = t.statusDenied;
                        document.getElementById('status').className = 'error';
                    }
                })
                .catch(error => {
                    const t = texts[isSpanish ? 'es' : 'en'];
                    document.getElementById('status').textContent = t.statusError;
                    document.getElementById('status').className = 'error';
                });
        }

        // Soporte para escritorio
        if (!('ontouchstart' in window)) {
            const slider = document.createElement('input');
            slider.type = 'range';
            slider.min = '0';
            slider.max = '360';
            slider.value = '0';
            slider.oninput = () => updateCompass(parseInt(this.value));
            document.getElementById('status').appendChild(document.createElement('br'));
            document.getElementById('status').appendChild(document.createElement('br'));
            document.getElementById('status').appendChild(slider);
        }

        // Inicializar idioma en ENG
        updateLanguage();
    </script>
</body>
</html>